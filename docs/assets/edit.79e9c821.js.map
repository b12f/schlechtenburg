{"version":3,"file":"edit.79e9c821.js","sources":["../../packages/image/lib/edit.tsx"],"sourcesContent":["import {\n  defineComponent,\n  reactive,\n  ref,\n  Ref,\n  watch,\n  PropType,\n} from 'vue';\nimport {\n  model,\n  SbToolbar,\n  SbButton,\n  SbBlock,\n  BlockData,\n} from '@schlechtenburg/core';\nimport { ParagraphData } from '@schlechtenburg/paragraph';\nimport {\n  getDefaultData,\n  ImageData,\n} from './util';\n\nimport './style.scss';\n\nexport default defineComponent({\n  name: 'sb-image-edit',\n\n  model,\n\n  props: {\n    onUpdate: { type: Function, default: () => {} },\n    data: {\n      type: (null as unknown) as PropType<ImageData>,\n      default: getDefaultData,\n    },\n  },\n\n  setup(props) {\n    const localData = reactive({\n      src: props.data.src,\n      alt: props.data.alt,\n      description: props.data.description,\n    });\n\n    const fileInput: Ref<null|HTMLInputElement> = ref(null);\n\n    watch(() => props.data, () => {\n      localData.src = props.data.src;\n      localData.alt = props.data.alt;\n      localData.description = props.data.description;\n    });\n\n    const selectImage = () => {\n      if (fileInput.value) {\n        fileInput.value.click();\n      }\n    };\n\n    const onImageSelect = () => {\n      if (fileInput.value && fileInput.value.files && fileInput.value.files.length) {\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n          const src = reader?.result?.toString();\n          if (!src) {\n            throw new Error('Couldn\\'t load image src');\n          }\n\n          props.onUpdate({\n            src,\n            alt: props.data.alt,\n            description: props.data.description,\n          });\n        });\n\n        reader.readAsDataURL(fileInput.value.files[0]);\n      }\n    };\n\n    const onDescriptionUpdate = (description: BlockData<ParagraphData>) => {\n      props.onUpdate({\n        ...props.data,\n        description,\n      });\n    };\n\n    return () => (\n      <figure class=\"sb-image\">\n        <SbToolbar>\n          {localData.src\n            ? <SbButton {...{ onClick: selectImage }}>Select Image</SbButton>\n            : null}\n          <input\n            type=\"file\"\n            ref={fileInput}\n            style=\"display: none;\"\n            onInput={onImageSelect}\n          />\n        </SbToolbar>\n        {localData.src\n          ? <>\n              <img\n                src={localData.src}\n                alt={localData.alt}\n                class=\"sb-image__content\"\n              />\n              <SbBlock\n                block={localData.description}\n                onUpdate={(updated: BlockData<ParagraphData>) => onDescriptionUpdate(updated)}\n              />\n            </>\n          : <SbButton {...{ onClick: selectImage }}>Select Image</SbButton>\n        }\n      </figure>\n    );\n  },\n});\n"],"names":["defineComponent","name","model","props","onUpdate","type","Function","default","data","getDefaultData","setup","localData","reactive","src","alt","description","fileInput","ref","selectImage","value","click","onImageSelect","files","length","reader","FileReader","addEventListener","result","toString","Error","readAsDataURL","onClick","onDescriptionUpdate","updated","__assign"],"mappings":"kMAuBA,MAAeA,EAAgB,CAC7BC,KAAM,gBAENC,MAAAA,EAEAC,MAAO,CACLC,SAAU,CAAEC,KAAMC,SAAUC,QAAS,QACrCC,KAAM,CACJH,KAAO,KACPE,QAASE,IAIbC,MAAMP,SACEQ,EAAYC,EAAS,CACzBC,IAAKV,EAAMK,KAAKK,IAChBC,IAAKX,EAAMK,KAAKM,IAChBC,YAAaZ,EAAMK,KAAKO,cAGpBC,EAAwCC,EAAI,SAE5C,IAAMd,EAAMK,OAAM,OACZK,IAAMV,EAAMK,KAAKK,MACjBC,IAAMX,EAAMK,KAAKM,MACjBC,YAAcZ,EAAMK,KAAKO,qBAG/BG,EAAc,KACdF,EAAUG,SACFA,MAAMC,SAIdC,EAAgB,QAChBL,EAAUG,OAASH,EAAUG,MAAMG,OAASN,EAAUG,MAAMG,MAAMC,OAAQ,OACtEC,EAAS,IAAIC,aACZC,iBAAiB,QAAQ,iBACxBb,EAAMW,0BAAQG,iBAAQC,eACvBf,QACG,IAAIgB,MAAM,6BAGZzB,SAAS,CACbS,IAAAA,EACAC,IAAKX,EAAMK,KAAKM,IAChBC,YAAaZ,EAAMK,KAAKO,mBAIrBe,cAAcd,EAAUG,MAAMG,MAAM,YAWxC,sBACS,oCAETX,EAAUE,SACSkB,QAASb,sCACzB,qBAEG,WACAF,QACC,yBACGK,YAGZV,EAAUE,2BAGEF,EAAUE,QACVF,EAAUG,UACT,sCAGCH,EAAUI,yBACgCiB,SAAoBC,SA5BzE7B,SAAS8B,OACV/B,EAAMK,MADI,CAEbO,YAAAA,KAHyBA,qBAgCLgB,QAASb"}