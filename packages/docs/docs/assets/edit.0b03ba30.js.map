{"version":3,"file":"edit.0b03ba30.js","sources":["../../../image/lib/edit.tsx"],"sourcesContent":["import {\n  defineComponent,\n  reactive,\n  ref,\n  Ref,\n  watch,\n  PropType,\n} from 'vue';\nimport {\n  model,\n  SbToolbar,\n  SbButton,\n  SbBlock,\n  IBlockData,\n  OnUpdateSelfCb,\n} from '@schlechtenburg/core';\nimport { IParagraphData } from '@schlechtenburg/paragraph';\nimport {\n  getDefaultData,\n  IImageData,\n} from './util';\n\nimport './style.scss';\n\nexport default defineComponent({\n  name: 'sb-image-edit',\n\n  model,\n\n  props: {\n    onUpdate: {\n      type: (null as unknown) as PropType<OnUpdateSelfCb<IImageData>>,\n      default: () => {},\n    },\n    data: {\n      type: (null as unknown) as PropType<IImageData>,\n      default: getDefaultData,\n    },\n  },\n\n  setup(props) {\n    const localData = reactive({\n      src: props.data.src,\n      alt: props.data.alt,\n      description: props.data.description,\n    });\n\n    const fileInput: Ref<null|HTMLInputElement> = ref(null);\n\n    watch(() => props.data, () => {\n      localData.src = props.data.src;\n      localData.alt = props.data.alt;\n      localData.description = props.data.description;\n    });\n\n    const selectImage = () => {\n      if (fileInput.value) {\n        fileInput.value.click();\n      }\n    };\n\n    const onImageSelect = () => {\n      if (fileInput.value && fileInput.value.files && fileInput.value.files.length) {\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n          const src = reader?.result?.toString();\n          if (!src) {\n            throw new Error('Couldn\\'t load image src');\n          }\n\n          props.onUpdate({\n            src,\n            alt: props.data.alt,\n            description: props.data.description,\n          });\n        });\n\n        reader.readAsDataURL(fileInput.value.files[0]);\n      }\n    };\n\n    const onDescriptionUpdate = (description: IBlockData<IParagraphData>) => {\n      props.onUpdate({\n        ...props.data,\n        description,\n      });\n    };\n\n    return () => (\n      <figure class=\"sb-image\">\n        <SbToolbar>\n          {localData.src\n            ? <SbButton {...{ onClick: selectImage }}>Select Image</SbButton>\n            : null}\n          <input\n            type=\"file\"\n            ref={fileInput}\n            style=\"display: none;\"\n            onInput={onImageSelect}\n          />\n        </SbToolbar>\n        {localData.src\n          ? <>\n              <img\n                src={localData.src}\n                alt={localData.alt}\n                class=\"sb-image__content\"\n              />\n              <SbBlock\n                block={localData.description}\n                onUpdate={(updated: IBlockData<IParagraphData>) => onDescriptionUpdate(updated)}\n              />\n            </>\n          : <SbButton {...{ onClick: selectImage }}>Select Image</SbButton>\n        }\n      </figure>\n    );\n  },\n});\n"],"names":["defineComponent","name","model","props","onUpdate","type","default","data","getDefaultData","setup","localData","reactive","src","alt","description","fileInput","ref","selectImage","value","click","onImageSelect","files","length","reader","FileReader","addEventListener","result","toString","Error","readAsDataURL","onClick","onDescriptionUpdate","updated","__assign"],"mappings":"8dAwBA,MAAeA,EAAgB,CAC7BC,KAAM,gBAENC,MAAAA,EAEAC,MAAO,CACLC,SAAU,CACRC,KAAO,KACPC,QAAS,QAEXC,KAAM,CACJF,KAAO,KACPC,QAASE,IAIbC,MAAMN,SACEO,EAAYC,EAAS,CACzBC,IAAKT,EAAMI,KAAKK,IAChBC,IAAKV,EAAMI,KAAKM,IAChBC,YAAaX,EAAMI,KAAKO,cAGpBC,EAAwCC,EAAI,SAE5C,IAAMb,EAAMI,OAAM,OACZK,IAAMT,EAAMI,KAAKK,MACjBC,IAAMV,EAAMI,KAAKM,MACjBC,YAAcX,EAAMI,KAAKO,qBAG/BG,EAAc,KACdF,EAAUG,SACFA,MAAMC,SAIdC,EAAgB,QAChBL,EAAUG,OAASH,EAAUG,MAAMG,OAASN,EAAUG,MAAMG,MAAMC,OAAQ,OACtEC,EAAS,IAAIC,aACZC,iBAAiB,QAAQ,iBACxBb,EAAMW,0BAAQG,iBAAQC,eACvBf,QACG,IAAIgB,MAAM,6BAGZxB,SAAS,CACbQ,IAAAA,EACAC,IAAKV,EAAMI,KAAKM,IAChBC,YAAaX,EAAMI,KAAKO,mBAIrBe,cAAcd,EAAUG,MAAMG,MAAM,YAWxC,sBACS,oCAETX,EAAUE,SACSkB,QAASb,sCACzB,qBAEG,WACAF,QACC,yBACGK,YAGZV,EAAUE,2BAGEF,EAAUE,QACVF,EAAUG,UACT,sCAGCH,EAAUI,yBACkCiB,SAAoBC,SA5B3E5B,SAAS6B,OACV9B,EAAMI,MADI,CAEbO,YAAAA,KAHyBA,qBAgCLgB,QAASb"}